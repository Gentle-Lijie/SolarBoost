1. 设计来源
1.1. 问题浅析
- 续航焦虑突出：电池容量有限，长途出行对充电设施依赖度高。
- 应急能源不足：缺乏灵活的备用电源或双向能量利用手段，限制了车辆在特殊场景下的适应性。
- 动能回收受限：再生制动的回收功率受到刹车时长、工况等因素制约，实际回收比例通常不足理论值，仅能回收约 70%C80% 的动能损失。
- 切换冲击问题：在驱动与回收模式瞬时切换时，可能产生较大的逆向电流冲击，对逆变器、电机控制器等功率电子器件带来潜在损伤与寿命缩短风险。
1.2. 现状调研
1.2.1. 提升动能回收效率
-分级回收策略：通过多档可调的回收力度（轻、中、强），适配不同路况，提升能量回收利用率。
- 缺点：高回收力度会使刹车时的顿挫感更为显著，影响乘车体验。低回收力度的效率太低，起不到提升续航的作用。
1.2.2. 逆向电流冲击
- 缓冲电容：增加缓冲电容吸收大电流，降低大电流对电池冲击。
- 缺点：电容本身寿命不可控，且更换较难。电容损坏会直接损坏电池。
2. 方法概述
2.1. 综述
提议设计一种基于路网数据和驾驶习惯的智能电能调度工具，通过读取路网数据预测前方驾驶行为，通过学习驾驶习惯预测驾驶员操作并提供相应动能调度反馈，并实时反馈至电能调度系统，提前调整相应输出功率和动能回收状态，提供更平滑的驾驶体验和更高的续航。
2.2. 模块拆解
2.2.1. 硬件集成
- 一个独立的充放电电池，为相应动能回收进行能量收集。同时支持通过车载太阳能板供电；
- 接入主电池系统
2.2.2. 数据接口
- 接入常见地图API数据，获取路网信息，前方路况，红绿灯情况等；
- 接入天气API数据和车身温度、雨量等传感器数据；
- 接入电池管理数据，如实时电流电压等；
- 获取驾驶习惯，如针对不同路面情况的驾驶偏好，针对不同红绿灯情况的驾驶习惯等
- 一个聚类和数据预测大模型，用于处理驾驶习惯进行机器侧深度学习。
2.2.3. 软件实现
- 输入数据：GPS导航、实时加速度、历史能耗曲线、路面情况
- 输出目标：预测驾驶情况动态调整能量分配，包括：
* 当有较大概率刹车时，提前降低输出能量分配，并在预测刹车时切换至动能回收模式，电能流入副电池；开始踩制动踏板时切换动能回收至主电池。
* 当有较大概率上坡时，提高能量分配，将PTV、车载空调等切换至副电池，主电池提供更大可用功率。
3. 技术细节
3.1. 系统结构和数据
- 数据源层：
- 车载信号：速度、加速度、转矩、SOC（电池荷电状态）、电机功率、附件功率（空调/车机/灯光）。
- 环境与上下文：GPS/地图坡度与路况、天气预报/辐照度、时间与方位角。
- 太阳能板与功率模块：光伏电压/电流/温度、MPPT状态、功率路由器（继电器/固态开关）状态。
- 模型与策略层：
- 能耗预测模型：短时预测车辆功率需求与附件功率。
- 太阳辐照与发电预测：基于天气与时间预测光伏可用功率。
- 调度策略：将太阳能在动力与附件之间动态分配，满足性能与效率。
- 执行与反馈层：
- 控制信号：对功率分配器/继电器的开关控制（安全冗余与限流）。
- 日志与监控：事件与异常记录、性能指标与节能数据。
- 服务与界面层：
- Flask API：数据采集、预测、调度、控制与可视化接口。
- Vue 前端：状态看板、场景模式选择、能量流动画、手动/自动切换。
机器学习算法与调度策略
能耗预测（车辆功率需求）
* 问题定义：短期回归预测，目标为未来 t\in [1,30] 秒的总功率需求 P_{\mathrm{veh}}(t) 与附件功率 P_{\mathrm{aux}}(t)。
* 输入特征：
o 历史时序：速度、加速度、坡度（从地图/GPS推断）、电机功率、SOC、附件功率。
o 元信息：驾驶模式（ECO/Normal/Sport）、路况类别（城市/高速/坡道）。
* 模型建议：
o 基础版：Gradient Boosting（XGBoost/LightGBM），对工程特征敏感，训练快、部署稳。
o 时序版：LSTM/Temporal Convolution（TCN），用于更平滑的短时预测。
* 损失函数：加权 MSE，提升峰值场景（上坡/加速）预测准确性。
* 训练数据：历史行驶日志（1C2 周采集），包含多场景、不同天气与道路类型。
太阳能发电预测
* 输入特征：时刻、地理位置、天气（云量/降雨/温度）、板面温度与历史发电。
* 模型建议：
o 基础版：Random Forest/GBDT 回归，用于 5C15 分钟滚动预测。
o 校正项：基于辐照度物理模型的上/下界约束，避免过拟合导致的极端输出。
* 约束：输出功率 P_{\mathrm{pv}} 应满足板参数与MPPT限值。
能量调度策略（优化与规则混合）
* 目标函数：
\min \; \alpha \cdot \mathrm{SOC\_ drop}+\beta \cdot \mathrm{Perf\_ penalty}-\gamma \cdot \mathrm{PV\_ utilization}
o \mathrm{SOC\_ drop}：主电池荷电下降量
o \mathrm{Perf\_ penalty}：未满足动力需求的惩罚（避免动力短缺）
o \mathrm{PV\_ utilization}：光伏直供比例（鼓励使用太阳能）
* 约束条件：
o 限流与电压窗口：满足车辆附件和动力总线的电气安全范围。
o 切换抖动限制：继电器/固态开关最小保持时间，避免高频抖动。
o 优先级：高能耗瞬发场景优先保障动力；非高能耗场景优先附件与充电。
* 策略实现：
* 混合策略：短时滚动预测 + 规则控制（状态机：High-demand / Cruise / Park），每 1C2s 评估一次。
* 安全回退：预测置信度低时，退回“附件优先”或“仅充电”保守模式。
硬件接口与安全机制
* 信号采集：
o CAN 总线：车速、电机功率、SOC、附件功率；使用 USB-CAN 或现成车载网关适配。
o 光伏侧：MPPT 控制器输出的电压/电流/功率；温度传感器用于热降额。
* 功率路由：
o 动力总线：仅在电气兼容且经评估可行时进行辅助（建议限制比例与时间窗）。
o 附件总线：优先直供空调、信息娱乐系统与照明，风险更低。
* 安全策略：
* 软/硬件限流、过压欠压保护、过温保护。
* 开关抖动避免与故障回退（检测异常→切断太阳能直供→转为充电或断开）。
* 审计日志：记录每次切换与边界条件触发。
后端 API 设计（Flask）
路由与数据结构概览
* 数据类型：
o VehicleState: 车载状态（速度、SOC、功率等）
o EnvContext: 天气/位置与时间上下文
o PVState: 光伏参数与功率
o ControlCommand: 路由与模式控制指令
* 模式：auto, manual, eco, performance
主要接口说明
* POST /api/ingest：一次性输入车辆/环境/光伏数据，返回预测与调度指令。
* POST /api/mode：切换系统模式（auto/manual/eco/performance）。
* POST /api/command：在手动模式下下发自定义功率分配。
* GET /api/state：获取当前系统模式与最近指令。
前端 UI 设计（Vue）
功能与布局
* 顶部状态栏：模式切换（Auto/Eco/Performance/Manual）、SOC、电机功率、PV功率。
* 能量流动画：太阳能板 → 动力总线/附件总线/充电，实时流量线宽随功率变化。
* 预测卡片：未来 30 秒车辆功率与 PV 功率预测曲线。
* 手动控制面板：仅在 Manual 模式下显示滑块（to_motor/to_aux/charge）。
* 日志与告警：切换事件、异常告警（过温/过压）、节能统计。

4. Demo展示
5. 总结展望
5.1. 创新点
- 提供多电能供能源，降低变化的电流场景下对主电池的冲击。
- 引入机器学习算法，基于驾驶行为、路况和天气数据进行预测性调度，在高能耗场景下提前优化能源分配。
- 提供动态能量管理方案，太阳能直接参与附件系统供电。
- 采用可集成化设计，接入车辆中控，无缝化链接车辆电脑。
5.2. 市场应用前景
- 本方案能够有效缓解电动车用户的续航焦虑，特别适合城市通勤与长途驾驶场景，具有广泛的市场吸引力。
- 太阳能应急供电功能满足了户外露营、应急救援等特殊场景的需求，拓展了电动车的使用边界和附加价值。
- 方案契合全球“双碳”战略和绿色出行趋势，具备政策支持与社会认可度，有望成为新能源汽车行业的重要发展方向。
- 该系统不仅适用于smart车型，还可推广至其他新能源车企和改装市场，具备规模化应用与商业化落地的潜力。
